#!/usr/bin/env bash

set -e

log_dir=/var/vcap/data/sys/log/sample-app
run_dir=/var/vcap/data/sys/run/sample-app
pidfile="$run_dir/sample-app.pid"

mkdir -p "$log_dir" "$run_dir"
chown vcap:vcap "$log_dir" "$run_dir"

date +%F_%T >> $log_dir/sample-app.out.log
date +%F_%T >> $log_dir/sample-app.err.log

/sbin/start-stop-daemon \
  --pidfile "$pidfile" \
  --make-pidfile \
  --start \
  --exec /var/vcap/packages/sample-app/bin/sample-app \
   >> "$log_dir/sample-app.out.log" \
  2>> "$log_dir/sample-app.err.log"
